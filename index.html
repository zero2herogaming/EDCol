<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Elite Finder — Debug (Header Key)</title>
  <script src="https://cdn.jsdelivr.net/npm/axios@1/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    input, button { margin-right: .5rem; }
    pre { background: #f0f0f0; padding: 1rem; max-height: 300px; overflow:auto; }
  </style>
</head>
<body>

  <h1>Elite Finder – Debug (Header Key)</h1>

  <div>
    <label>CMDR: <input id="cmdr" placeholder="zero2hero"/></label>
    <label>Key:  <input id="key" style="width:300px" placeholder="abcd1234…"/></label>
    <button id="save">Save</button>
    <button id="clear">Clear</button>
  </div>
  <p id="creds" style="color:#666"></p>

  <div>
    <input id="system" placeholder="System (Sol)" />
    <input id="radius" type="number" value="30" style="width:60px"/>
    <button id="go">Search</button>
  </div>

  <p id="status"></p>
  <pre id="debug"></pre>

<script>
const WORKER = 'https://snowy-thunder-7b95.zero2herotwitch.workers.dev/';
const LSKEY  = 'inaraCreds';

function $(s){return document.querySelector(s);}
function showCreds(){
  const c=JSON.parse(localStorage.getItem(LSKEY)||'{}');
  $('p#creds').textContent = c.cmdr ? `Using CMDR=${c.cmdr} Key=${c.key}` : 'No creds saved';
}
$('#save').onclick = ()=>{
  localStorage.setItem(LSKEY,JSON.stringify({cmdr:$('#cmdr').value, key:$('#key').value}));
  showCreds();
};
$('#clear').onclick = ()=>{
  localStorage.removeItem(LSKEY);
  showCreds();
};
if(localStorage.getItem(LSKEY)){
  const c=JSON.parse(localStorage.getItem(LSKEY));
  $('#cmdr').value=c.cmdr; $('#key').value=c.key;
}
showCreds();

async function callInara(events){
  const c=JSON.parse(localStorage.getItem(LSKEY)||'{}');
  const req = {
    header: {
      appName: 'Debug',
      appVersion: '1.0',
      isDeveloped: true,
      apiKey: c.key,             // ← must be here
      commanderName: c.cmdr      // ← and here
    },
    events
  };
  console.log('REQUEST BODY →', req);
  const res = await axios.post(WORKER, req);
  console.log('RAW RESPONSE ←', res.data);
  return res.data;
}

$('#go').onclick = async ()=>{
  $('#status').textContent='Querying…';
  $('#debug').textContent='';
  try{
    const r = await callInara([{
      eventName:'searchSystemsInSphere',
      eventData:{systemName:$('#system').value, searchRadius:+$('#radius').value}
    }]);
    // Dump the first event
    if(r.events && r.events[0]){
      $('#debug').textContent = JSON.stringify(r.events[0],null,2);
      $('#status').textContent = 'Got eventStatus='+r.events[0].eventStatus;
    } else {
      throw new Error('No events in response');
    }
  }catch(err){
    console.error(err);
    $('#status').textContent='Error: '+err.message;
  }
};
</script>
</body>
</html>
